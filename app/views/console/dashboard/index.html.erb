<% content_for(:title, t('console.dashboard.dashboard')) %>

<%= form_tag({:controller => 'dashboard', :action => 'index'}, :remote => true, :class => 'form-ajax') do %>
  <%= hidden_field_tag :ajax_handler, 'handle_dashboard' %>
  <%= hidden_field_tag :start_date, drpInitialStartDate(), :id => 'start_date' %>
  <%= hidden_field_tag :end_date, drpInitialEndDate(), :id => 'end_date' %>
  <%= submit_tag('Submit', :id => 'dashboard-commit', :style=>"display:none;") %>

  <%= render 'search' %>

  <div class="mt-4 mb-4 border-bottom" style="font-size: 24px;"> <%= t 'console.dashboard.sales_summary' %> </div>

  <div class="loading-wrapper">
    <ul class="nav nav-tabs" id="sales-summary-tabs" role="tablist">
      <li class="nav-item">
        <a class="font-weight-bold nav-link active" id="revenue-tab" data-toggle="tab" href="#revenue" role="tab" aria-controls="revenue" aria-selected="true">REVENUE</a>
      </li>
      <li class="nav-item">
        <a class="font-weight-bold nav-link" id="sales-tab" data-toggle="tab" href="#sales" role="tab" aria-controls="sales" aria-selected="false">SALES</a>
      </li>
      <%# <li class="nav-item">
        <a class="font-weight-bold nav-link" id="profit-tab" data-toggle="tab" href="#profit" role="tab" aria-controls="profit" aria-selected="false">PROFIT</a>
      </li> %>
    </ul>
    <div class="tab-content" id="sales-summary-tabs-content">
      <div class="tab-pane fade" id="sales" role="tabpanel" aria-labelledby="sales-tab">
        <h5 class="font-weight-bold pt-3 pl-3"><%= t 'console.dashboard.sales_amount' %></h5>
        <div class="d-flex justify-content-between pl-5 pr-5 pb-5 pt-4 bg-white border border-bottom-0">
          <div>
            <div><%= t 'console.dashboard.total_sales_uppercase' %></div>
            <div id="total-sales" class="font-weight-bold h3 mb-0"></div>
          </div>
          <%= select :sales_aggregation_unit, :type, aggregationUnitArray(), {}, {class: 'pull-down-btn unavailable-btn h-100'} %>
        </div>
        <div class="pl-5 pr-5 pb-5 mb-4 border border-top-0 bg-white">
          <canvas id="salesBarChart" style="height: 350px; width: 100%;" class="chartjs-render-monitor"></canvas>
        </div>
      </div>
      <div class="tab-pane fade show active" id="revenue" role="tabpanel" aria-labelledby="revenue-tab">
        <h5 class="font-weight-bold pt-3 pl-3">GROSS REVENUE</h5>
        <div class="d-flex justify-content-between pl-5 pr-5 pb-5 pt-4 bg-white border border-bottom-0">
          <div>
            <div>TOTAL SALES BREAKDOWN</div>
          </div>
          <div id="revenueLegend"></div>
          <%#= select :sales_aggregation_unit, :type, aggregationUnitArray(), {}, {class: 'pull-down-btn unavailable-btn h-100'} %>
        </div>
        <div class="pl-5 pr-5 pb-5 mb-4 border border-top-0 bg-white">
          <canvas id="revenueBarChart" style="height: 350px; width: 100%;" class="chartjs-render-monitor"></canvas>
        </div>
      </div>
      <%# <div class="tab-pane fade" id="profit" role="tabpanel" aria-labelledby="profit-tab">
      <h5 class="font-weight-bold pt-3 pl-3">GROSS PROFIT</h5>
        <div class="d-flex justify-content-between pl-5 pr-5 pb-5 pt-4 bg-white border border-bottom-0">
          <div>
            <div>TOTAL PROFIT</div>
            <div id="total-profit" class="font-weight-bold h3 mb-0"></div>
          </div>
          %= select :sales_aggregation_unit, :type, aggregationUnitArray(), {}, {class: 'pull-down-btn unavailable-btn h-100'} %
        </div>
        <div class="pl-5 pr-5 pb-5 mb-4 border border-top-0 bg-white">
          <canvas id="profitBarChart" style="height: 350px; width: 100%;" class="chartjs-render-monitor"></canvas>
        </div>
      </div>%>
    </div> 
  </div>
  <div class="mt-4 mb-4 border-bottom" style="font-size: 24px;"> CHECKIN SUMMARY </div>
  <div class="loading-wrapper">
    <h5 class="font-weight-bold pt-3 pl-3"><%= t 'console.dashboard.checkins_amount' %></h5>
    <div class="d-flex justify-content-between pl-5 pr-5 pb-5 pt-4 bg-white border border-bottom-0">
      <div>
        <div><%= t 'console.dashboard.total_checkins' %></div>
        <div id="total-checkins" class="font-weight-bold h3 mb-0"></div>
      </div>
      <%= select :checkins_aggregation_unit, :type, aggregationUnitArray(), {}, {class: 'pull-down-btn unavailable-btn h-100'} %>
    </div>
    <div class="pl-5 pr-5 pb-5 mb-4 border border-top-0 bg-white">
      <canvas id="checkinsBarChart" style="height: 350px; width: 100%;" class="chartjs-render-monitor"></canvas>
    </div>
  </div>
<% end %>
<!-- end form_tag -->

<div id="product-summary">
  <div class="mt-5 mb-4 border-bottom" style="font-size: 24px;"> <%= t 'console.dashboard.product_summary' %> </div>
  <div class="d-flex justify-content-between">
    <div class="p-4 border bg-white mb-4" style="width:48%;">
      <div class="loading-wrapper">
        <div class="small text-secondary"><%= t 'console.dashboard.top_sales' %></div>
        <div class="scroll-body-table-container mt-3">
          <table class="table">
            <thead class="thead-light">
              <tr>
                <th class="category"><%= t 'console.dashboard.product_category' %></th>
                <th class="text-right sold"><%= t 'console.dashboard.sold' %></th>
                <th class="text-center sales"><%= t 'console.dashboard.total_sales_lowercase' %></th>
              </tr>
            </thead>
            <tbody id="details-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div id="pieChart" class="border bg-white mb-4 pb-4" style="width:48%;">
      <div class="loading-wrapper">
        <div class="small text-secondary pt-4 pl-4"><%= t 'console.dashboard.sales_percentage' %></div>
        <div class="mx-auto" style="position: relative; width:90%; height:50vh">
          <canvas id="salesPieChart" class="chartjs-render-monitor"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="d-flex justify-content-between">
  <div style="width:48%;">
    <div class="mt-3 mb-3 border-bottom" style="font-size: 24px;"> <%= t 'console.dashboard.sales_mechanic' %> </div>
    <div class="loading-wrapper">
      <div class="p-4 border bg-white mb-4">
        <div class="small text-secondary"><%= t 'console.dashboard.sales_details' %></div>
        <div class="scroll-body-table-container mt-3">
          <table class="table">
            <thead class="thead-light">
              <tr>
                <th class="name"><%= t 'console.common.mechanic' %></th>
                <th class="text-center info"><%= t 'console.dashboard.total_sales_lowercase' %></th>
              </tr>
            </thead>
            <tbody id="mechanic-details-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div style="width:48%;">
    <div class="mt-3 mb-3 border-bottom" style="font-size: 24px;"> <%= t 'console.dashboard.mechanic_attendance' %> </div>
    <div class="loading-wrapper">
      <div class="p-4 border bg-white mb-4">
        <div class="small text-secondary"><%= t 'console.dashboard.attendance_details' %></div>
        <div class="scroll-body-table-container mt-3">
          <table class="table">
            <thead class="thead-light">
              <tr>
                <th class="name"><%= t 'console.common.mechanic' %></th>
                <th class="text-center info"><%= t 'console.dashboard.days_worked' %></th>
              </tr>
            </thead>
            <tbody id="mechanic-attendence-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mt-3 mb-4 border-bottom" style="font-size: 24px;"> <%= t 'console.dashboard.sales_payment_type' %> </div>
<div class="loading-wrapper">
  <div class="p-4 border bg-white mb-4">
    <div class="small text-secondary"><%= t 'console.dashboard.sales_details' %></div>
    <table class="table mt-3">
      <thead class="thead-light">
        <tr>
          <th><%= t 'console.dashboard.payment_type' %></th>
          <th class="text-center"><%= t 'console.common.total' %></th>
        </tr>
      </thead>
      <tbody id="sales-by-type-tbody">
      </tbody>
    </table>
  </div>
</div>
