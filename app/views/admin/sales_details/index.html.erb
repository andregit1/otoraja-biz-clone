<% content_for(:title, t('admin.sales_details.sales_details')) %>

<%= form_tag({:controller => 'sales_details', :action => 'index'}, :remote => true, :class => 'form-ajax') do %>
  <%= hidden_field_tag :ajax_handler, 'handle_dashboard' %>
  <%= hidden_field_tag :start_date, drpInitialStartDate(), :id => 'start_date' %>
  <%= hidden_field_tag :end_date, drpInitialEndDate(), :id => 'end_date' %>
  <%= hidden_field_tag :dashboard_shop, session[:default_user_shop] %>
  
  <%= submit_tag('Submit', :id => 'dashboard-commit', :style=>"display:none;") %>

  <%= render 'search' %>
  
<% end %>
<!-- end form_tag -->

<div id="product-summary">
  <div class="d-flex justify-content-between mt-5 mb-4 border-bottom"><span style="font-size: 24px;"> <%= t 'admin.sales_details.product_summary' %> </span><span class="pb-2"><button class="date-range-readonly scroll-up-btn d-block"></button></span></div>
  <div class="d-flex flex-column">
    
    <div class="loading-wrapper"> 
      <div id="pieChart" class="border bg-white mb-4 pb-4">
        <div class="d-flex justify-content-between">
          <div class="small text-secondary pt-4 pl-4"><%= t 'admin.sales_details.sales_percentage' %></div>
          <div class="d-flex flex-column">
            <div class="pt-4 pr-4"><button class="date-range-readonly scroll-up-btn d-block"></button></div>
          </div>
        </div>
        <div class="row">
          <canvas id="salesPieChart" style="max-height: 350px; width: 80%" class="p-4 col-12 col-md-8 chartjs-render-monitor"></canvas>
          <div class="p-4 col-12 col-md-4">
            <div class="small text-secondary pt-2 pr-4 font-weight-bold">Total Penjualan</div>
            <div id="total-sales" class="text-large font-weight-bold"></div>
            <div id="pie-legend"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="loading-wrapper">
      <div class="border bg-white mb-4">
        <div class="p-4 flex-top">
          <div class="d-flex justify-content-between"><span class="small text-secondary"><%= t 'admin.sales_details.top_sales' %></span><span class="pb-2"><button class="date-range-readonly scroll-up-btn d-block"></button></span></div>
            <div id="sales-categories" class="row">
              <div class="form-group search-field col">
                <%= text_field_tag 'shop-product-search', '', class:'form-control mr-2', autocomplete: 'off', placeholder: t('admin.common.keyword')  %>
                <i id="shop-product-search-clear-btn" class="icon icon-Cross search-with-clear clear"></i>
                <i id="shop-product-search-btn" class="icon icon-Search search-with-clear"></i>
              </div>
              <div class="col">
                <select id="sales_details_category" class='form-control'></select>
              </div>
          </div>
        </div>
        <div id="sales-details" class="mt-3">
          <div class="pagination-content">
            <div class="table-responsive">
              <table class="table">
                <thead class="thead-light">
                  <tr>
                    <th class="category"><i class="fas fa-sort mr-1" data-property="name"></i><%= t 'admin.sales_details.product' %></th>
                    <th class="text-right sold"><i class="fas fa-sort mr-1" data-property="sold"></i><%= t 'admin.sales_details.sold' %></th>
                    <th class="text-center sales"><i class="fas fa-sort mr-1 asc" data-property="sales"></i>Nilai (Rp.)</th>
                    <th class="text-right"><i class="fas fa-sort mr-1" data-property="cogs"></i><%= t 'admin.sales_details.modal' %> (Rp.)</th>
                    <th class="text-right"><i class="fas fa-sort mr-1" data-property="discount"></i><%= t 'admin.sales_details.diskon' %> (Rp.)</th>
                    <th class="text-right"><i class="fas fa-sort mr-1" data-property="gross_profit"></i><%= t 'admin.sales_details.keuntungan' %> (Rp.)</th>
                  </tr>
                </thead>
                <tbody id="details-tbody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

